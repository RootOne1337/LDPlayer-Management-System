@echo off
chcp 65001 >nul
setlocal EnableDelayedExpansion

:: üöÄ –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô –ó–ê–ü–£–°–ö LDPLAYER MANAGEMENT SYSTEM
:: –° –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π –∏ —Å—É–ø–µ—Ä-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

cls
echo.
echo ================================================================================
echo                    üöÄ LDPLAYER MANAGEMENT SYSTEM üöÄ
echo ================================================================================
echo.
echo [%time%] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–ø—É—Å–∫—É...
echo.

:: –ü—Ä–æ–≤–µ—Ä–∫–∞ Python
python --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå –û–®–ò–ë–ö–ê: Python –Ω–µ –Ω–∞–π–¥–µ–Ω!
    echo –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.8+ –∏ –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ PATH
    pause
    exit /b 1
)

echo ‚úÖ Python –æ–±–Ω–∞—Ä—É–∂–µ–Ω
python --version

:: –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–µ—Ä–≤–µ—Ä–∞
cd /d "%~dp0"
echo ‚úÖ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: %cd%

:: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8
set PYTHONIOENCODING=utf-8

:: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo.
echo [%time%] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...
python -c "import fastapi, uvicorn, pydantic" >nul 2>&1
if errorlevel 1 (
    echo ‚ö†Ô∏è  –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
    echo üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...
    pip install -r requirements.txt
    if errorlevel 1 (
        echo ‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!
        pause
        exit /b 1
    )
) else (
    echo ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
)

:: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
echo.
echo [%time%] –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Python...
taskkill /F /IM python.exe >nul 2>&1
timeout /t 1 /nobreak >nul

:: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
if not exist "logs" mkdir logs
if not exist "configs" mkdir configs
if not exist "backups" mkdir backups
echo ‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã

:: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
echo.
echo ================================================================================
echo                       üéØ –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê –° –î–ò–ê–ì–ù–û–°–¢–ò–ö–û–ô
echo ================================================================================
echo.
echo üì° API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8001/api
echo üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8001/docs
echo üé® Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: http://localhost:8001/static/index.html
echo.
echo ‚ö†Ô∏è  –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C
echo.
echo ================================================================================
echo.

:: –ó–∞–ø—É—Å–∫ —Å –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
python start_server.py

:: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
echo.
echo.
echo ================================================================================
echo                          üìä –°–ï–†–í–ï–† –û–°–¢–ê–ù–û–í–õ–ï–ù
echo ================================================================================
echo.
echo [%time%] –°–µ—Ä–≤–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É
echo.
pause
